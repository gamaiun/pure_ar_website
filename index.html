<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <style>
      .a-enter-vr,
      .a-enter-vr-button {
        display: none !important;
      }
      .a-enter-ar,
      .a-enter-ar-button {
        position: fixed !important;
        bottom: 20px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        z-index: 9999 !important;
        width: auto !important;
        padding: 10px 15px !important;
      }
    </style>
  </head>

  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-box position="0 1 -3" color="blue" look-at="[gps-camera]"></a-box>
      <a-sphere
        position="1 1 -5"
        radius="0.5"
        color="red"
        look-at="[gps-camera]"
      ></a-sphere>
      <a-camera gps-camera="gpsMinDistance: 1;" rotation-reader></a-camera>
    </a-scene>

    <script>
      function logMessage(message) {
        document.body.innerHTML += `<p style="color:blue;">${message}</p>`;
        console.log(message);
      }

      function testGPS() {
        if (!navigator.geolocation) {
          logMessage("‚ùå Geolocation is not supported by this browser.");
          return;
        }

        logMessage("üîÑ Requesting GPS...");

        navigator.geolocation.getCurrentPosition(
          (position) => {
            logMessage(
              `üìç Browser GPS: ${position.coords.latitude}, ${position.coords.longitude}`
            );
          },
          (error) => {
            logMessage(`‚ùå GPS Error: ${error.message}`);
          },
          { enableHighAccuracy: true, timeout: 10000 }
        );
      }

      document.addEventListener("DOMContentLoaded", testGPS);
    </script>

    <script>
      document
        .querySelector("a-camera")
        ?.addEventListener("gps-camera-update", (event) => {
          logMessage(
            `üìç GPS Updated (AR.js): ${event.detail.position.latitude}, ${event.detail.position.longitude}`
          );
        });

      // ‚úÖ Force GPS Updates Every 5 Seconds
      setInterval(() => {
        logMessage("üîÑ Forcing AR.js GPS update...");
        const gpsCamera = document.querySelector("[gps-camera]");
        if (gpsCamera) {
          gpsCamera.setAttribute("gpsMinDistance", "0.5");
        } else {
          logMessage("‚ùå gps-camera not found!");
        }
      }, 5000);

      // ‚úÖ Fix: Force GPS Updates When AR Mode Starts
      document.addEventListener("enter-ar", () => {
        logMessage("üöÄ AR Mode Activated! Forcing GPS update...");
        const gpsCamera = document.querySelector("[gps-camera]");
        if (gpsCamera) {
          gpsCamera.setAttribute("gpsMinDistance", "0.1");
        } else {
          logMessage("‚ùå gps-camera not found in AR mode!");
        }
      });

      // ‚úÖ Fix: Restart AR.js in AR Mode
      document.addEventListener("enter-ar", () => {
        logMessage("üîÑ Re-initializing GPS tracking in AR mode...");
        const scene = document.querySelector("a-scene");
        scene.setAttribute(
          "arjs",
          "sourceType: webcam; debugUIEnabled: false;"
        );
      });
    </script>
  </body>
</html>
