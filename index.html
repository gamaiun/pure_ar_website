<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GPS-based AR at User's Location</title>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- AR.js for location-based AR -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #enterAR {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 999;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Button to enter AR mode -->
    <button id="enterAR">Enter AR</button>

    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; gpsMinDistance: 0;"
      renderer="logarithmicDepthBuffer: true;"
    >
      <!-- The camera that reads the user's GPS position & orientation -->
      <a-camera gps-camera rotation-reader></a-camera>

      <!-- Green cube (initially at 0,0 until we get the user's location) -->
      <a-entity
        id="green-cube"
        gps-entity-place="latitude: 0; longitude: 0;"
        scale="20 20 20"
      >
        <a-box color="green"></a-box>
      </a-entity>

      <!-- Blue sphere (initially at 0,0, offset later) -->
      <a-entity
        id="blue-sphere"
        gps-entity-place="latitude: 0; longitude: 0;"
        scale="20 20 20"
      >
        <a-sphere color="blue"></a-sphere>
      </a-entity>
    </a-scene>

    <script>
      const sceneEl = document.querySelector("a-scene");
      const btnEnterAR = document.getElementById("enterAR");

      // When "Enter AR" is clicked, activate AR mode (camera + GPS)
      btnEnterAR.addEventListener("click", () => {
        sceneEl.enterVR();
        btnEnterAR.style.display = "none";
      });

      // Once the scene is fully loaded, listen for the user's GPS position
      sceneEl.addEventListener("loaded", () => {
        window.addEventListener("gps-camera-update-position", (e) => {
          // Current lat/lon from the device
          const userLat = e.detail.position.latitude;
          const userLon = e.detail.position.longitude;

          // 1) Place the green cube at the user's exact location
          const greenCube = document.getElementById("green-cube");
          greenCube.setAttribute("gps-entity-place", {
            latitude: userLat,
            longitude: userLon,
          });

          // 2) Place the blue sphere ~10 meters north
          // (roughly add 0.00009Â° to latitude for ~10m offset, depends on location)
          const sphereLat = userLat + 0.00009;
          const sphereLon = userLon;

          const blueSphere = document.getElementById("blue-sphere");
          blueSphere.setAttribute("gps-entity-place", {
            latitude: sphereLat,
            longitude: sphereLon,
          });
        });
      });
    </script>
  </body>
</html>
